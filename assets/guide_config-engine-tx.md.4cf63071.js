import{_ as e,o as t,c as o,R as a}from"./chunks/framework.5065ad62.js";const u=JSON.parse('{"title":"Config Engine","description":"","frontmatter":{},"headers":[],"relativePath":"guide/config-engine-tx.md","filePath":"guide/config-engine-tx.md","lastUpdated":1689775819000}'),s={name:"guide/config-engine-tx.md"},n=a(`<h1 id="config-engine" tabindex="-1">Config Engine <a class="header-anchor" href="#config-engine" aria-label="Permalink to &quot;Config Engine&quot;">​</a></h1><h2 id="transmit-commands" tabindex="-1">Transmit commands <a class="header-anchor" href="#transmit-commands" aria-label="Permalink to &quot;Transmit commands&quot;">​</a></h2><p>Once you have rendered templates you can transmit them to the nodes via SSH. They can either be sent as plain commands, or you can use transactions if supported by your node.</p><p>These actions map to three commands:</p><ul><li><code>config send</code> - Send generated text to the node. This will typically be used for show commands, no configuration session is started on the node.</li><li><code>config compare</code> - Start configuration priviledge level. Usually this is also the start of a transaction. Compare the results and discard any changes.</li><li><code>config commit</code> - Start configuration priviledge level. Execute a commit transaction.</li></ul><h3 id="template-pre-processing" tabindex="-1">Template pre-processing <a class="header-anchor" href="#template-pre-processing" aria-label="Permalink to &quot;Template pre-processing&quot;">​</a></h3><p>Generated templates are pre-processed before sending.</p><ul><li>Empty whitespace will be removed. This includes blank lines &amp; leading and trailing whitespace</li><li>If the node config supports comments, these will be removed</li></ul><h2 id="transport" tabindex="-1">Transport <a class="header-anchor" href="#transport" aria-label="Permalink to &quot;Transport&quot;">​</a></h2><p>Containerlab Kinds (from the topology file) will be mapped to Scrapligo&#39;s platforms, and these platforms contain the knowledge of how to authenticate to the node and how to do any required priviledge level changes for configuration etc. The labctl repo contains details about transactions.</p><p>Scrapligo platforms are available <a href="https://github.com/scrapli/scrapligo/tree/main/assets/platforms" target="_blank" rel="noreferrer">here</a></p><p>The mapping of Kinds to platforms and other options (comment character, compare and commit commands per kind) can be found <a href="https://github.com/labctl/labctl/blob/main/utils/tx/kindmap.go" target="_blank" rel="noreferrer">here</a>. Please feel free to submit PR&#39;s for any missing platforms!</p><h2 id="ssh-settings" tabindex="-1">SSH settings <a class="header-anchor" href="#ssh-settings" aria-label="Permalink to &quot;SSH settings&quot;">​</a></h2><p>By default SSH uses the default username and password from containerlab and will target containerlab&#39;s long name as the SSH host and port 22. These long names names are used for DNS resolution and added to /etc/hosts when you deploy your lab. The format of the long name is shown below:</p><table><thead><tr><th>clab-<code>&lt;topo name&gt;</code>-<code>&lt;node name&gt;</code></th></tr></thead></table><p>The prefix <strong>clab</strong> can be changed with <code>prefix</code> key in the topology file.</p><p>You can override the SSH settings by defining additional <code>vars</code> on the nodes.</p><table><thead><tr><th>Variable name</th><th>Description</th></tr></thead><tbody><tr><td><code>ssh_host</code></td><td>The target SSH host name or IP. Defaults to the containerlab long name.</td></tr><tr><td><code>ssh_port</code></td><td>The SSH port. Default 22</td></tr><tr><td><code>ssh_platform</code></td><td>The scrapligo platform. Default s to the Kind map <a href="#transport">more</a></td></tr><tr><td><code>ssh_username</code></td><td>The node&#39;s username. Defaults to the containerlab default username.</td></tr><tr><td><code>ssh_password</code></td><td>The node&#39;s password. Defaults to the containerlab default password.</td></tr></tbody></table><h3 id="additional-ssh-settings" tabindex="-1">Additional SSH settings <a class="header-anchor" href="#additional-ssh-settings" aria-label="Permalink to &quot;Additional SSH settings&quot;">​</a></h3><p>The SSH module will also read your SSH config file, located at <code>~/.ssh/config</code></p><p>The example entry below applies to all hosts starting with <code>clab-</code>, sets the default username to admin and any other allowed SSH option.</p><div class="language-config"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Host clab-*</span></span>
<span class="line"><span style="color:#A6ACCD;">    User admin</span></span>
<span class="line"><span style="color:#A6ACCD;">    UserKnownHostsFile /dev/null</span></span>
<span class="line"><span style="color:#A6ACCD;">    StrictHostKeyChecking no</span></span>
<span class="line"><span style="color:#A6ACCD;">    HostkeyAlgorithms +ssh-rsa</span></span></code></pre></div><h4 id="stricthostkeychecking-userknownhostsfile" tabindex="-1">StrictHostKeyChecking &amp; UserKnownHostsFile <a class="header-anchor" href="#stricthostkeychecking-userknownhostsfile" aria-label="Permalink to &quot;StrictHostKeyChecking &amp; UserKnownHostsFile&quot;">​</a></h4><p>With StrictHostKeyChecking disabled, SSH will add any unknown host to the Known Hosts file, by default located at <code>~/.ssh/known_hosts</code>. If the host already exists in the Known Hosts and the host key is different, SSH will not connect to the host.</p><p>Everytime you re-deploy nodes with containerlab, the hosts keys will change and to ease operation you could set the known hosts file to <code>/dev/null</code>, so that SSH will always accept the host key.</p><h4 id="hostkeyalgorithms" tabindex="-1">HostkeyAlgorithms <a class="header-anchor" href="#hostkeyalgorithms" aria-label="Permalink to &quot;HostkeyAlgorithms&quot;">​</a></h4><p>Recent versions of OpenSSH removed some Hostkey Algorithms and you might have to allow these until such time as the Network Operating system supports the latest key algorithms. This is done with <code>HostkeyAlgorithms</code></p><p>When you try to SSH to the node you should get a message similar to: <br><code>Unable to negotiate with x.x.x.x port 22: no matching host key type found. Their offer: ssh-rsa,ssh-dss</code></p><h2 id="target-non-containerlab-labs" tabindex="-1">Target non-containerlab labs <a class="header-anchor" href="#target-non-containerlab-labs" aria-label="Permalink to &quot;Target non-containerlab labs&quot;">​</a></h2><p>Not all your labs might be deployed by containerlab, so when you have any other setup, you can use the ssh variables to target the correct nodes. The only thing you&#39;ll need is a valid topo file.</p><p>With <code>ssh_host</code> and <code>ssh_port</code> you can target physical nodes or even nodes deployed directly with <code>virsh</code> over one or mulitple hosts.</p>`,31),i=[n];function r(l,d,h,c,p,m){return t(),o("div",null,i)}const f=e(s,[["render",r]]);export{u as __pageData,f as default};
