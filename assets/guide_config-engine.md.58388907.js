import{_ as e,o as s,c as a,g as n}from"./app.ec7c4a9b.js";const g=JSON.parse('{"title":"Config engine","description":"","frontmatter":{},"headers":[{"level":2,"title":"Overview","slug":"overview"},{"level":2,"title":"Variables","slug":"variables"},{"level":2,"title":"Variables on links","slug":"variables-on-links"},{"level":2,"title":"Node Role","slug":"node-role"},{"level":2,"title":"Template files","slug":"template-files"},{"level":2,"title":"Magic Variables","slug":"magic-variables"}],"relativePath":"guide/config-engine.md","lastUpdated":1661265713000}'),l={name:"guide/config-engine.md"},o=n(`<h1 id="config-engine" tabindex="-1">Config engine <a class="header-anchor" href="#config-engine" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The config engine is shared with containerlab and all your templates and even the command line flags can be used from either <code>labctl config</code> or <code>containerlab config</code></p><p>Command line flag reference <a href="/reference/config.html">config</a></p></div><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-hidden="true">#</a></h2><p>The Config Engine combines a powerful templating language with the knowledge of your network topology.</p><p>Templates allow us to render CLI snippets using variables, the real power behind Config Engine comes from the knowledge of your network. At a high level this allows us:</p><ol><li>Declare logical variables as part of the topology. E.g add an IP address to a node/link.</li><li>Easily template network links and nodes. Variables are pre-processed to allow templates to simply use local and far-end variables.</li><li>Send commands to a router (we know the kind of router). This includes knowledge of how to log in and even enable configuration transactions when required.</li></ol><p>The Config Engine uses Golang&#39;s Text Templates as the templating language. We&#39;ll cover the basics with many examples, but there are also great external resources covering the <a href="https://learn.hashicorp.com/tutorials/nomad/go-template-syntax" target="_blank" rel="noopener noreferrer">Go template syntax</a>.</p><h2 id="variables" tabindex="-1">Variables <a class="header-anchor" href="#variables" aria-hidden="true">#</a></h2><p>Variables provide custom input to the templates, and they are specified directly in your topology file. They can be placed under Nodes or Links.</p><p>Below you see variables defined for a node. It is located under the node&#39;s <code>config.vars</code> branch.</p><div class="language-yaml"><span class="copy"></span><div class="highlight-lines"><br><br><br><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><br></div><pre><code><span class="line"><span style="color:#F07178;">topology</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">nodes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">pe_1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">config</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">vars</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F07178;">key_2</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value_2</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F07178;">key_n</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value_n</span></span>
<span class="line"></span></code></pre></div><p>Similar to the rest of the topology file, defaults can be provided for variables on the <code>kind</code> of the node, or under <code>defaults</code></p><details class="details custom-block"><summary>Values are inherited from <code>kinds</code> and <code>defaults</code></summary><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#F07178;">topology</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">kinds</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">vr-sros</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ghcr.io/nokia/srlinux</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">config</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nodes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">pe_1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vr-sros</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">pe_2</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vr-sros</span></span>
<span class="line"></span></code></pre></div></details><h2 id="variables-on-links" tabindex="-1">Variables on links <a class="header-anchor" href="#variables-on-links" aria-hidden="true">#</a></h2><p>Links can also have variables. These are specified in the topology file next to the link endpoints. Generally link variables are specified in pairs, where each entry is applicable to the endpoint at the same position.</p><p>In the example below, <code>1/1/c1/1</code> applies to endpoint <code>pe1:eth1</code> and <code>1/1/c2/1</code> applies to endpoint <code>pe2:eth2</code></p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#F07178;">topology</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">links</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">endpoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pe1:eth1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pe2:eth2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">vars</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1/1/c1/1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1/1/c2/1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">instance_id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span></code></pre></div><p>In some cases a value might be applicable to both endpoint, and then you only need to specify it as a single value (e.g. <code>instance_id</code> above).</p><p>Template files typically target nodes and not links, so link variables are added to each node as a list named <code>clab_links</code>.</p><h2 id="node-role" tabindex="-1">Node Role <a class="header-anchor" href="#node-role" aria-hidden="true">#</a></h2><p>The role of the node points to the template that needs to be deployed on that node. Examples of roles can be leaves, spines or PEs, or CEs. If you have no specific roles in your topology, the bare minimum might be that you have different templates for different types (or kinds) of nodes.</p><p>::: important The role is defined in the <code>clab_role</code> variable. It is optional, and by default this will be the node&#39;s <code>kind</code>. :::</p><h2 id="template-files" tabindex="-1">Template files <a class="header-anchor" href="#template-files" aria-hidden="true">#</a></h2><p>Template files are located in the supplied <a href="/reference/config.html"><code>--template-paths</code></a></p><p>The naming convention is shown below</p><table><thead><tr><th><code>&lt;template-name&gt;</code>__<code>&lt;role&gt;</code>.tmpl</th></tr></thead></table><p>The template names are specific on the input using the <code>--template-names</code> / <code>-l</code> flags. The config engine supports deploying a list of templates.</p><h2 id="magic-variables" tabindex="-1">Magic Variables <a class="header-anchor" href="#magic-variables" aria-hidden="true">#</a></h2><p>We&#39;ve mentioned that link variables are included with the node variables, but lets dive into the detail of how variables are pre-processed before being passed to templates.</p><p>The <a href="/guide/config-engine-ui.html">Config Engine UI</a> is a great tool to visualize these</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you are more of a visual person, you can see this in action in the Config Engine UI - [serve]</p></div><table><thead><tr><th>variable</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td><code>clab_node</code></td><td>Topo</td><td>The node name.</td></tr><tr><td><code>clab_kind</code></td><td>Topo</td><td>The node kind.</td></tr><tr><td><code>clab_management_ipv*</code></td><td>Docker</td><td>Only present in <code>containerlab</code> empty in <code>labctl</code></td></tr><tr><td><code>clab_role</code></td><td>\u2728vars</td><td>The role that will be used to determine the template file.</td></tr><tr><td><code>clab_links</code></td><td>\u2728</td><td>Populated with all the links</td></tr><tr><td><code>clab_nodes</code></td><td>\u2728</td><td>Populated with all the nodes in the topology</td></tr><tr><td><code>clab_system_ip</code></td><td>vars</td><td>from the topo file</td></tr></tbody></table><p>Each <code>clab_link</code> will have the following structure</p><table><thead><tr><th>variable</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td><code>clab_link_ip</code></td><td>\u2728</td><td>The link IP address</td></tr><tr><td><code>clab_link_name</code></td><td>\u2728</td><td>The link name</td></tr><tr><td><code>clab_far</code></td><td>\u2728</td><td>A dictionary with all the variables, but for the far-end node</td></tr><tr><td>key 1..n</td><td>Topo</td><td>All the variables defined in the topo file</td></tr></tbody></table>`,34),t=[o];function p(i,r,c,d,h,y){return s(),a("div",null,t)}var f=e(l,[["render",p]]);export{g as __pageData,f as default};
